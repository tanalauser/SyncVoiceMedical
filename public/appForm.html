<!DOCTYPE html>
<html id="htmlLang" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyncVoice Medical - Application</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="appForm.css">
</head>
<body>
    <!-- Navigation Bar -->
    <header class="app-header">
        <a href="index.html" class="app-logo navbar-brand" id="logoLink">
            <img src="SyncVoiceMedicalLogo.png" alt="SyncVoice Medical">
        </a>
        <div class="user-info">
            <div class="user-details">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-meta">
                    <span class="user-name" id="userEmail">Utilisateur</span>
                    <span class="user-badge trial" id="accountTypeBadge">Essai gratuit</span>
                </div>
            </div>
            <div class="days-remaining" id="daysRemainingContainer" style="display: none;">
                <span class="days-label" id="daysLabel">Jours restants:</span>
                <span class="days-value" id="daysRemaining">-</span>
            </div>
            <nav class="nav-links navbar-menu">
                <a href="account.html" class="nav-link" id="myAccountLink">Mon Compte</a>
                <a href="form.html?plan=paid" class="nav-link upgrade-link" id="upgradeLink" style="display: none;">Passer à Premium</a>
                <a href="#" class="nav-link logout-link" id="logoutLink">Se déconnecter</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="app-main">
        <!-- Title Section -->
        <div class="app-title-section">
            <h1 class="app-title" id="appTitle">Transcription Vocale</h1>
            <p class="app-subtitle" id="appSubtitle">Commencez à dicter pour transcrire votre texte</p>
        </div>

        <!-- Voice Form -->
        <form class="voice-form" id="voiceForm">
            <!-- Subject Input -->
            <div class="subject-section form-group">
                <label for="subjectInput" class="subject-label form-label" id="subjectLabel">Sujet / Référence:</label>
                <input type="text" id="subjectInput" class="subject-input form-input" placeholder="Ex: Consultation du 31/07/2025">
            </div>

            <!-- Transcription Wrapper - New 80/20 Layout -->
            <div class="transcription-wrapper">
                <!-- Transcription Area (80%) -->
                <div class="transcription-section">
                    <label for="transcriptionText" class="transcription-label form-label" id="transcriptionLabel">Transcription:</label>
                    <div class="transcription-container">
                        <textarea 
                            id="transcriptionText" 
                            class="transcription-textarea form-textarea" 
                            placeholder="Appuyez sur le bouton 'Parlez en Français', attendez que le compte à rebours se termine, puis parlez. Votre transcription apparaîtra ici..."
                        ></textarea>
                        <div class="transcription-footer">
                            <span class="char-count" id="charCount">0 caractères</span>
                            <span class="ai-notice" id="AICanMakeMistakes_message">* L'IA peut faire des erreurs. Veuillez vérifier la transcription.</span>
                        </div>
                    </div>
                </div>

                <!-- Control Buttons Panel (18%) - Vertical Stack -->
                <div class="controls-panel controls">
                    <!-- Recording Status Indicator -->
                    <div class="recording-status recording-indicator" id="recordingIndicator">
                        <div class="recording-dot"></div>
                        <span class="recording-text" id="recordingText">Enregistrement en cours...</span>
                    </div>

                    <!-- Primary Action - Start Speaking -->
                    <button type="button" id="startButton" class="control-btn primary start-btn btn">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                            <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                        </svg>
                        <span class="btn-text" id="startBtnText">Parlez en Français</span>
                    </button>

                    <!-- Pause Button -->
                    <button type="button" id="pauseButton" class="control-btn secondary pause stop-btn btn" disabled>
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                        </svg>
                        <span class="btn-text" id="pauseBtnText">Pause</span>
                    </button>

                    <!-- Stop Button -->
                    <button type="button" id="stopButton" class="control-btn secondary stop stop-btn btn" disabled>
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 6h12v12H6z"/>
                        </svg>
                        <span class="btn-text" id="stopBtnText">Stop</span>
                    </button>

                    <div class="controls-divider"></div>

                    <!-- Copy Button -->
                    <button type="button" id="copyButton" class="control-btn action copy copy-btn btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                        <span class="btn-text" id="copyBtnText">Copiez tout</span>
                    </button>

                    <!-- Template Button -->
                    <button type="button" id="templateButton" class="control-btn action action-btn btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <span class="btn-text">Modèle Word</span>
                    </button>

                    <!-- Clear Button -->
                    <button type="button" id="clearButton" class="control-btn action action-btn btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        <span class="btn-text">Tout Effacer</span>
                    </button>

                    <div class="controls-divider"></div>

                    <!-- Quit Button -->
                    <button type="button" id="quitButton" class="control-btn quit action-btn btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        <span class="btn-text">Quitter</span>
                    </button>
                </div>
            </div>

            <!-- Status Message (for errors/success) -->
            <div id="statusMessage" class="status-message"></div>
        </form>
    </main>

    <!-- Template Modal (keeping original structure for compatibility) -->
    <div id="templateModal" class="template-modal">
        <div class="template-modal-content modal-content">
            <div class="template-modal-header modal-header">
                <h2 class="template-modal-title" id="templateModalTitle">Choisissez un modèle</h2>
                <button class="template-modal-close close-modal">&times;</button>
            </div>
            <div class="template-list template-grid">
                <div class="template-item" data-template="consultation">
                    <h4>Consultation Médicale</h4>
                    <p>Modèle pour une consultation médicale standard</p>
                </div>
                <div class="template-item" data-template="specialist">
                    <h4>Consultation Spécialisée</h4>
                    <p>Modèle pour une consultation avec un spécialiste</p>
                </div>
                <div class="template-item" data-template="surgery">
                    <h4>Chirurgie</h4>
                    <p>Modèle pour un rapport chirurgical</p>
                </div>
                <div class="template-item" data-template="prescription">
                    <h4>Ordonnance</h4>
                    <p>Modèle pour une ordonnance médicale</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Countdown Overlay -->
    <div id="countdownOverlay" class="countdown-overlay">
        <div class="countdown-number" id="countdownNumber">3</div>
        <div class="countdown-text" id="countdownText">Préparation...</div>
    </div>

    <!-- Footer -->
    <footer class="app-footer footer">
        <p>&copy; 2025 SyncVoice Medical. <span id="footerText">Tous droits réservés.</span></p>
    </footer>

    <!-- Include the language detection module if available -->
    <script src="languageDetection.js"></script>

    <!-- DocX library for Word export -->
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- Main application JavaScript (your existing file) -->
    <script src="appForm.js"></script>
    
    <!-- Character counter enhancement -->
    <script>
        // Character counter
        document.addEventListener('DOMContentLoaded', function() {
            const textarea = document.getElementById('transcriptionText');
            const charCount = document.getElementById('charCount');
            
            if (textarea && charCount) {
                function updateCount() {
                    const count = textarea.value.length;
                    charCount.textContent = count + ' caractères';
                }
                
                textarea.addEventListener('input', updateCount);
                
                // Watch for programmatic changes
                const observer = new MutationObserver(updateCount);
                observer.observe(textarea, { childList: true, characterData: true, subtree: true });
                
                // Also poll periodically for speech recognition updates
                setInterval(updateCount, 500);
                
                updateCount();
            }
            
            // User avatar initialization
            const userEmail = document.getElementById('userEmail');
            const userAvatar = document.getElementById('userAvatar');
            if (userEmail && userAvatar) {
                const email = userEmail.textContent || 'U';
                userAvatar.textContent = email.charAt(0).toUpperCase();
            }
        });
    </script>
</body>
</html>
