            </a>
            <select id="language-select" class="language-select">
                <option value="fr">üá´üá∑ FR</option>
                <option value="en">üá¨üáß EN</option>
                <option value="de">üá©üá™ DE</option>
                <option value="es">üá™üá∏ ES</option>
                <option value="it">üáÆüáπ IT</option>
                <option value="pt">üáµüáπ PT</option>
            </select>
        </div>
    </nav>

    <main class="main-content">
        <div class="form-card">
            <div class="form-header">
                <span class="plan-badge free" id="planBadge">Essai gratuit</span>
                <h1 class="form-title" id="formTitle">Cr√©ez votre compte</h1>
                <p class="form-subtitle" id="formSubtitle">Remplissez les informations ci-dessous</p>
            </div>

            <!-- Billing Toggle (Paid only) -->
            <div class="billing-toggle hidden" id="billingToggle">
                <span class="toggle-label" id="monthlyLabel">Mensuel</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="billingSwitch">
                    <span class="toggle-slider"></span>
                </label>
                <span class="toggle-label" id="yearlyLabel">Annuel</span>
                <span class="savings-badge">-17%</span>
            </div>

            <!-- Price Display (Paid only) -->
            <div class="price-display hidden" id="priceDisplay">
                <div class="price-amount"><span id="priceSymbol">‚Ç¨</span><span id="priceValue">25</span></div>
                <div class="price-period" id="pricePeriod">par mois</div>
            </div>

            <div id="errorMessage" class="message error"></div>
            <div id="successMessage" class="message success"></div>

            <form id="registrationForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName" class="form-label" id="firstNameLabel">Pr√©nom <span class="required">*</span></label>
                        <input type="text" id="firstName" name="prenom" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName" class="form-label" id="lastNameLabel">Nom <span class="required">*</span></label>
                        <input type="text" id="lastName" name="nom" class="form-input" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label" id="emailLabel">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" class="form-input" required>
                </div>

                <div class="form-group">
                    <label for="company" class="form-label" id="companyLabel">√âtablissement / Cabinet</label>
                    <input type="text" id="company" name="societe" class="form-input">
                </div>

                <!-- Address fields (Paid only) -->
                <div id="addressFields" class="hidden">
                    <div class="form-group">
                        <label for="address" class="form-label" id="addressLabel">Adresse <span class="required">*</span></label>
                        <input type="text" id="address" name="adresse" class="form-input">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="postalCode" class="form-label" id="postalCodeLabel">Code postal <span class="required">*</span></label>
                            <input type="text" id="postalCode" name="codePostal" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="city" class="form-label" id="cityLabel">Ville <span class="required">*</span></label>
                            <input type="text" id="city" name="ville" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="country" class="form-label" id="countryLabel">Pays <span class="required">*</span></label>
                        <select id="country" name="pays" class="form-select">
                            <option value="France">France</option>
                            <option value="Belgium">Belgique</option>
                            <option value="Switzerland">Suisse</option>
                            <option value="Luxembourg">Luxembourg</option>
                            <option value="Germany">Allemagne</option>
                            <option value="Austria">Autriche</option>
                            <option value="Spain">Espagne</option>
                            <option value="Italy">Italie</option>
                            <option value="Portugal">Portugal</option>
                            <option value="United Kingdom">Royaume-Uni</option>
                            <option value="Ireland">Irlande</option>
                            <option value="Netherlands">Pays-Bas</option>
                            <option value="Other">Autre</option>
                        </select>
                    </div>
                </div>

                <!-- Payment Section (Paid only) -->
                <div class="payment-section hidden" id="paymentSection">
                    <div class="payment-title">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="4" width="22" height="16" rx="2"/>
                            <line x1="1" y1="10" x2="23" y2="10"/>
                        </svg>
                        <span id="paymentTitle">Informations de paiement</span>
                    </div>
                    <div id="payment-element"></div>
                    <div id="card-errors"></div>
                </div>

                <div class="terms-group">
                    <input type="checkbox" id="termsAccept" class="terms-checkbox" required>
                    <label for="termsAccept" class="terms-label" id="termsLabel">
                        J'accepte les <a href="#" target="_blank">conditions d'utilisation</a> et la <a href="#" target="_blank">politique de confidentialit√©</a>
                    </label>
                </div>

                <button type="submit" id="submitButton" class="submit-btn">
                    <span id="submitText">Cr√©er mon compte</span>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </form>

            <div class="form-footer">
                <p>
                    <span id="hasAccountText">D√©j√† un compte ?</span>
                    <a href="login.html" id="loginLink" class="form-link">Se connecter</a>
                </p>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Configuration
            const PRICING = {
                EUR: { symbol: '‚Ç¨', monthly: 25, yearly: 250 },
                GBP: { symbol: '¬£', monthly: 21, yearly: 218 }
            };

            const GBP_COUNTRIES = ['United Kingdom', 'UK', 'GB'];

            // State
            const urlParams = new URLSearchParams(window.location.search);
            let plan = urlParams.get('plan') || 'free';
            let billing = urlParams.get('billing') || 'monthly';
            let currency = urlParams.get('currency')?.toUpperCase() || 'EUR';
            let lang = urlParams.get('lang') || localStorage.getItem('selectedLanguage') || 'fr';
            
            // Stripe
            let stripe = null;
            let cardElement = null;

            // Translations
            const t = {
                fr: {
                    freeBadge: 'Essai gratuit - 7 jours',
                    paidBadgeMonthly: 'Abonnement mensuel',
                    paidBadgeYearly: 'Abonnement annuel',
                    formTitle: 'Cr√©ez votre compte',
                    formSubtitleFree: 'Commencez votre essai gratuit de 7 jours',
                    formSubtitlePaid: 'Acc√®s illimit√© √† la transcription m√©dicale',
                    firstName: 'Pr√©nom',
                    lastName: 'Nom',
                    email: 'Email',
                    company: '√âtablissement / Cabinet',
                    address: 'Adresse',
                    postalCode: 'Code postal',
                    city: 'Ville',
                    country: 'Pays',
                    paymentTitle: 'Informations de paiement',
                    terms: "J'accepte les <a href='#'>conditions d'utilisation</a> et la <a href='#'>politique de confidentialit√©</a>",
                    submitFree: "Commencer l'essai gratuit",
                    submitPaid: 'Payer et commencer',
                    hasAccount: 'D√©j√† un compte ?',
                    login: 'Se connecter',
                    return: 'Retour',
                    monthly: 'Mensuel',
                    yearly: 'Annuel',
                    perMonth: 'par mois',
                    perYear: 'par an',
                    processing: 'Traitement...',
                    success: 'Inscription r√©ussie ! V√©rifiez votre email.',
                    error: 'Une erreur est survenue. Veuillez r√©essayer.'
                },
                en: {
                    freeBadge: 'Free trial - 7 days',
                    paidBadgeMonthly: 'Monthly subscription',
                    paidBadgeYearly: 'Annual subscription',
                    formTitle: 'Create your account',
                    formSubtitleFree: 'Start your 7-day free trial',
                    formSubtitlePaid: 'Unlimited access to medical transcription',
                    firstName: 'First name',
                    lastName: 'Last name',
                    email: 'Email',
                    company: 'Practice / Organization',
                    address: 'Address',
                    postalCode: 'Postal code',
                    city: 'City',
                    country: 'Country',
                    paymentTitle: 'Payment information',
                    terms: "I accept the <a href='#'>terms of service</a> and <a href='#'>privacy policy</a>",
                    submitFree: 'Start free trial',
                    submitPaid: 'Pay and start',
                    hasAccount: 'Already have an account?',
                    login: 'Sign in',
                    return: 'Back',
                    monthly: 'Monthly',
                    yearly: 'Yearly',
                    perMonth: 'per month',
                    perYear: 'per year',
                    processing: 'Processing...',
                    success: 'Registration successful! Check your email.',
                    error: 'An error occurred. Please try again.'
                },
                de: {
                    freeBadge: 'Kostenlose Testversion - 7 Tage',
                    paidBadgeMonthly: 'Monatliches Abo',
                    paidBadgeYearly: 'Jahresabo',
                    formTitle: 'Erstellen Sie Ihr Konto',
                    formSubtitleFree: 'Starten Sie Ihre 7-t√§gige Testversion',
                    formSubtitlePaid: 'Unbegrenzter Zugang zur medizinischen Transkription',
                    firstName: 'Vorname',
                    lastName: 'Nachname',
                    email: 'E-Mail',
                    company: 'Praxis / Organisation',
                    address: 'Adresse',
                    postalCode: 'PLZ',
                    city: 'Stadt',
                    country: 'Land',
                    paymentTitle: 'Zahlungsinformationen',
                    terms: "Ich akzeptiere die <a href='#'>AGB</a> und <a href='#'>Datenschutzrichtlinie</a>",
                    submitFree: 'Testversion starten',
                    submitPaid: 'Bezahlen und starten',
                    hasAccount: 'Bereits ein Konto?',
                    login: 'Anmelden',
                    return: 'Zur√ºck',
                    monthly: 'Monatlich',
                    yearly: 'J√§hrlich',
                    perMonth: 'pro Monat',
                    perYear: 'pro Jahr',
                    processing: 'Verarbeitung...',
                    success: 'Registrierung erfolgreich! √úberpr√ºfen Sie Ihre E-Mail.',
                    error: 'Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.'
                },
                es: {
                    freeBadge: 'Prueba gratuita - 7 d√≠as',
                    paidBadgeMonthly: 'Suscripci√≥n mensual',
                    paidBadgeYearly: 'Suscripci√≥n anual',
                    formTitle: 'Cree su cuenta',
                    formSubtitleFree: 'Comience su prueba gratuita de 7 d√≠as',
                    formSubtitlePaid: 'Acceso ilimitado a la transcripci√≥n m√©dica',
                    firstName: 'Nombre',
                    lastName: 'Apellido',
                    email: 'Correo electr√≥nico',
                    company: 'Centro / Organizaci√≥n',
                    address: 'Direcci√≥n',
                    postalCode: 'C√≥digo postal',
                    city: 'Ciudad',
                    country: 'Pa√≠s',
                    paymentTitle: 'Informaci√≥n de pago',
                    terms: "Acepto los <a href='#'>t√©rminos</a> y la <a href='#'>pol√≠tica de privacidad</a>",
                    submitFree: 'Comenzar prueba gratuita',
                    submitPaid: 'Pagar y comenzar',
                    hasAccount: '¬øYa tiene una cuenta?',
                    login: 'Iniciar sesi√≥n',
                    return: 'Volver',
                    monthly: 'Mensual',
                    yearly: 'Anual',
                    perMonth: 'al mes',
                    perYear: 'al a√±o',
                    processing: 'Procesando...',
                    success: '¬°Registro exitoso! Revise su correo.',
                    error: 'Ocurri√≥ un error. Por favor, int√©ntelo de nuevo.'
                },
                it: {
                    freeBadge: 'Prova gratuita - 7 giorni',
                    paidBadgeMonthly: 'Abbonamento mensile',
                    paidBadgeYearly: 'Abbonamento annuale',
                    formTitle: 'Crea il tuo account',
                    formSubtitleFree: 'Inizia la tua prova gratuita di 7 giorni',
                    formSubtitlePaid: 'Accesso illimitato alla trascrizione medica',
                    firstName: 'Nome',
                    lastName: 'Cognome',
                    email: 'Email',
                    company: 'Studio / Organizzazione',
                    address: 'Indirizzo',
                    postalCode: 'CAP',
                    city: 'Citt√†',
                    country: 'Paese',
                    paymentTitle: 'Informazioni di pagamento',
                    terms: "Accetto i <a href='#'>termini</a> e la <a href='#'>privacy policy</a>",
                    submitFree: 'Inizia prova gratuita',
                    submitPaid: 'Paga e inizia',
                    hasAccount: 'Hai gi√† un account?',
                    login: 'Accedi',
                    return: 'Indietro',
                    monthly: 'Mensile',
                    yearly: 'Annuale',
                    perMonth: 'al mese',
                    perYear: "all'anno",
                    processing: 'Elaborazione...',
                    success: 'Registrazione riuscita! Controlla la tua email.',
                    error: "Si √® verificato un errore. Per favore riprova."
                },
                pt: {
                    freeBadge: 'Teste gr√°tis - 7 dias',
                    paidBadgeMonthly: 'Assinatura mensal',
                    paidBadgeYearly: 'Assinatura anual',
                    formTitle: 'Crie sua conta',
                    formSubtitleFree: 'Comece seu teste gr√°tis de 7 dias',
                    formSubtitlePaid: 'Acesso ilimitado √† transcri√ß√£o m√©dica',
                    firstName: 'Nome',
                    lastName: 'Sobrenome',
                    email: 'Email',
                    company: 'Cl√≠nica / Organiza√ß√£o',
                    address: 'Endere√ßo',
                    postalCode: 'CEP',
                    city: 'Cidade',
                    country: 'Pa√≠s',
                    paymentTitle: 'Informa√ß√µes de pagamento',
                    terms: "Aceito os <a href='#'>termos</a> e a <a href='#'>pol√≠tica de privacidade</a>",
                    submitFree: 'Come√ßar teste gr√°tis',
                    submitPaid: 'Pagar e come√ßar',
                    hasAccount: 'J√° tem uma conta?',
                    login: 'Entrar',
                    return: 'Voltar',
                    monthly: 'Mensal',
                    yearly: 'Anual',
                    perMonth: 'por m√™s',
                    perYear: 'por ano',
                    processing: 'Processando...',
                    success: 'Registro bem-sucedido! Verifique seu email.',
                    error: 'Ocorreu um erro. Por favor, tente novamente.'
                }
            };

            // Elements
            const form = document.getElementById('registrationForm');
            const planBadge = document.getElementById('planBadge');
            const billingToggle = document.getElementById('billingToggle');
            const billingSwitch = document.getElementById('billingSwitch');
            const priceDisplay = document.getElementById('priceDisplay');
            const addressFields = document.getElementById('addressFields');
            const paymentSection = document.getElementById('paymentSection');
            const submitButton = document.getElementById('submitButton');
            const langSelect = document.getElementById('language-select');

            // Initialize
            function init() {
                langSelect.value = lang;
                document.documentElement.lang = lang;
                
                if (plan === 'paid') {
                    billingToggle.classList.remove('hidden');
                    priceDisplay.classList.remove('hidden');
                    addressFields.classList.remove('hidden');
                    paymentSection.classList.remove('hidden');
                    planBadge.classList.remove('free');
                    planBadge.classList.add('paid');
                    
                    // Set address fields as required
                    document.getElementById('address').required = true;
                    document.getElementById('postalCode').required = true;
                    document.getElementById('city').required = true;
                    
                    billingSwitch.checked = billing === 'yearly';
                    initStripe();
                }
                
                updateContent();
                updatePricing();
            }

            function updateContent() {
                const tr = t[lang] || t.fr;
                
                document.getElementById('returnText').textContent = tr.return;
                document.getElementById('returnBtn').href = 'index.html?lang=' + lang;
                document.getElementById('formTitle').textContent = tr.formTitle;
                document.getElementById('formSubtitle').textContent = plan === 'paid' ? tr.formSubtitlePaid : tr.formSubtitleFree;
                document.getElementById('firstNameLabel').innerHTML = tr.firstName + ' <span class="required">*</span>';
                document.getElementById('lastNameLabel').innerHTML = tr.lastName + ' <span class="required">*</span>';
                document.getElementById('emailLabel').innerHTML = tr.email + ' <span class="required">*</span>';
                document.getElementById('companyLabel').textContent = tr.company;
                document.getElementById('addressLabel').innerHTML = tr.address + ' <span class="required">*</span>';
                document.getElementById('postalCodeLabel').innerHTML = tr.postalCode + ' <span class="required">*</span>';
                document.getElementById('cityLabel').innerHTML = tr.city + ' <span class="required">*</span>';
                document.getElementById('countryLabel').innerHTML = tr.country + ' <span class="required">*</span>';
                document.getElementById('paymentTitle').textContent = tr.paymentTitle;
                document.getElementById('termsLabel').innerHTML = tr.terms;
                document.getElementById('submitText').textContent = plan === 'paid' ? tr.submitPaid : tr.submitFree;
                document.getElementById('hasAccountText').textContent = tr.hasAccount;
                document.getElementById('loginLink').textContent = tr.login;
                document.getElementById('loginLink').href = 'login.html?lang=' + lang;
                document.getElementById('monthlyLabel').textContent = tr.monthly;
                document.getElementById('yearlyLabel').textContent = tr.yearly;
                
                // Update badge
                if (plan === 'paid') {
                    planBadge.textContent = billingSwitch.checked ? tr.paidBadgeYearly : tr.paidBadgeMonthly;
                } else {
                    planBadge.textContent = tr.freeBadge;
                }
            }

            function updatePricing() {
                const tr = t[lang] || t.fr;
                const pricing = PRICING[currency];
                const isYearly = billingSwitch.checked;
                
                document.getElementById('priceSymbol').textContent = pricing.symbol;
                document.getElementById('priceValue').textContent = isYearly ? pricing.yearly : pricing.monthly;
                document.getElementById('pricePeriod').textContent = isYearly ? tr.perYear : tr.perMonth;
                
                // Update toggle labels
                document.getElementById('monthlyLabel').classList.toggle('active', !isYearly);
                document.getElementById('yearlyLabel').classList.toggle('active', isYearly);
            }

            async function initStripe() {
                try {
                    const configResponse = await fetch('/api/config');
                    const config = await configResponse.json();
                    
                    stripe = Stripe(config.stripePublishableKey);
                    const elements = stripe.elements();
                    
                    cardElement = elements.create('card', {
                        style: {
                            base: {
                                color: '#2A3439',
                                fontFamily: 'Source Sans Pro, sans-serif',
                                fontSize: '16px',
                                '::placeholder': { color: '#8A9BA3' }
                            },
                            invalid: { color: '#E74C3C' }
                        }
                    });
                    
                    cardElement.mount('#payment-element');
                    
                    cardElement.on('change', (event) => {
                        const errorEl = document.getElementById('card-errors');
                        errorEl.textContent = event.error ? event.error.message : '';
                    });
                } catch (error) {
                    console.error('Stripe init error:', error);
                }
            }

            // Event listeners
            langSelect.addEventListener('change', (e) => {
                lang = e.target.value;
                localStorage.setItem('selectedLanguage', lang);
                document.documentElement.lang = lang;
                updateContent();
                updatePricing();
            });

            billingSwitch.addEventListener('change', () => {
                billing = billingSwitch.checked ? 'yearly' : 'monthly';
                updateContent();
                updatePricing();
            });

            // Country change updates currency
            document.getElementById('country').addEventListener('change', (e) => {
                const selectedCountry = e.target.value;
                currency = GBP_COUNTRIES.includes(selectedCountry) ? 'GBP' : 'EUR';
                updatePricing();
            });

            // Form submission
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const tr = t[lang] || t.fr;
                const originalText = document.getElementById('submitText').textContent;
                
                submitButton.disabled = true;
                document.getElementById('submitText').textContent = tr.processing;
                
                const errorEl = document.getElementById('errorMessage');
                const successEl = document.getElementById('successMessage');
                errorEl.classList.remove('show');
                successEl.classList.remove('show');

                try {
                    const formData = {
                        firstName: document.getElementById('firstName').value,
                        lastName: document.getElementById('lastName').value,
                        email: document.getElementById('email').value,
                        company: document.getElementById('company').value,
                        version: plan,
                        billing: billing,
                        currency: currency,
                        language: lang
                    };

                    if (plan === 'paid') {
                        formData.address = document.getElementById('address').value;
                        formData.postalCode = document.getElementById('postalCode').value;
                        formData.city = document.getElementById('city').value;
                        formData.country = document.getElementById('country').value;
                    }

                    const response = await fetch('/api/send-activation', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();

                    if (result.success) {
                        if (result.requiresPayment && plan === 'paid' && stripe && cardElement) {
                            const { error, paymentIntent } = await stripe.confirmCardPayment(
                                result.clientSecret,
                                {
                                    payment_method: {
                                        card: cardElement,
                                        billing_details: {
                                            name: formData.firstName + ' ' + formData.lastName,
                                            email: formData.email
                                        }
                                    }
                                }
                            );

                            if (error) {
                                throw new Error(error.message);
                            }
                        }

                        successEl.textContent = tr.success;
                        successEl.classList.add('show');

                        setTimeout(() => {
                            window.location.href = 'success.html?lang=' + lang + (plan === 'paid' ? '&paid=true' : '');
                        }, 2000);
                    } else {
                        throw new Error(result.message || tr.error);
                    }
                } catch (error) {
                    console.error('Form error:', error);
                    errorEl.textContent = error.message || tr.error;
                    errorEl.classList.add('show');
                } finally {
                    submitButton.disabled = false;
                    document.getElementById('submitText').textContent = originalText;
                }
            });

            init();
        });
    </script>
</body>
</html>
